(()=>{"use strict";var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>l});const o=require("react");var n=t.n(o);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,r(n.key),n)}}function r(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}function a(t,e,o){return e=u(e),function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,h()?Reflect.construct(e,o||[],u(t).constructor):e.apply(t,o))}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(h=function(){return!!t})()}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}const l=function(t){function e(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=a(this,e,[t])).state={loaded:!1,finished:!1},o.isDrawing=!1,o.lastPoint=null,o.isFinished=!1,o.handleMouseMove=o.handleMouseMove.bind(o),o.handleMouseDown=o.handleMouseDown.bind(o),o.handleMouseUp=o.handleMouseUp.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t),o=e,i=[{key:"componentDidMount",value:function(){var t=this;this.isDrawing=!1,this.lastPoint=null,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.image=new Image,this.image.crossOrigin="Anonymous",this.image.onload=function(){t.ctx.drawImage(t.image,0,0,t.props.width,t.props.height),t.setState({loaded:!0})},this.image.src=this.props.image,this.props.customBrush&&(this.brushImage=new Image(this.props.customBrush.width,this.props.customBrush.height),this.brushImage.src=this.props.customBrush.image)}},{key:"reset",value:function(){this.canvas.style.opacity="1",this.ctx.globalCompositeOperation="source-over",this.ctx.drawImage(this.image,0,0,this.props.width,this.props.height),this.isFinished=!1}},{key:"getFilledInPixels",value:function(t){(!t||t<1)&&(t=1);var e=0,o=0,n=this.canvas.width,i=this.canvas.height;this.props.customCheckZone&&(e=this.props.customCheckZone.x,o=this.props.customCheckZone.y,n=this.props.customCheckZone.width,i=this.props.customCheckZone.height);for(var s=this.ctx.getImageData(e,o,n,i),r=s.data.length/t,a=0,h=0;h<s.data.length;h+=t)0===parseInt(s.data[h],10)&&a++;return Math.round(a/r*100)}},{key:"getMouse",value:function(t,e){var o=e.getBoundingClientRect(),n=o.top,i=o.left,s=window.pageYOffset||document.documentElement.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft,a=0,h=0;return t&&t.pageX&&t.pageY?(a=t.pageX-i-r,h=t.pageY-n-s):t&&t.touches&&(a=t.touches[0].clientX-i-r,h=t.touches[0].clientY-n),{x:a,y:h}}},{key:"distanceBetween",value:function(t,e){return t&&e?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):0}},{key:"angleBetween",value:function(t,e){return t&&e?Math.atan2(e.x-t.x,e.y-t.y):0}},{key:"handlePercentage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isFinished){var e=70;void 0!==this.props.finishPercent&&(e=this.props.finishPercent),t>e&&(!1!==this.props.fadeOutOnComplete&&(this.canvas.style.transition="1s",this.canvas.style.opacity="0"),this.setState({finished:!0}),this.props.onComplete&&this.props.onComplete(),this.isFinished=!0)}}},{key:"handleMouseDown",value:function(t){this.isDrawing=!0,this.lastPoint=this.getMouse(t,this.canvas)}},{key:"handleMouseMove",value:function(t){if(this.isDrawing){for(var e,o,n=this.getMouse(t,this.canvas),i=this.distanceBetween(this.lastPoint,n),s=this.angleBetween(this.lastPoint,n),r=0;r<i;r++)e=this.lastPoint?this.lastPoint.x+Math.sin(s)*r:0,o=this.lastPoint?this.lastPoint.y+Math.cos(s)*r:0,this.ctx.globalCompositeOperation="destination-out",this.brushImage&&this.props.customBrush?this.ctx.drawImage(this.brushImage,e,o,this.props.customBrush.width,this.props.customBrush.height):(this.ctx.beginPath(),this.ctx.arc(e,o,this.props.brushSize||20,0,2*Math.PI,!1),this.ctx.fill());this.lastPoint=n,this.handlePercentage(this.getFilledInPixels(32))}}},{key:"handleMouseUp",value:function(){this.isDrawing=!1}},{key:"render",value:function(){var t,e=this,o={width:this.props.width+"px",height:this.props.height+"px",position:"relative",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none",cursor:null!==(t=this.props)&&void 0!==t&&t.brushCursor?this.props.brushCursor:"arrow"},i={visibility:this.state.loaded?"visible":"hidden",width:"100%",height:"100%"};return n().createElement("div",{className:"ScratchCard__Container",style:o},n().createElement("canvas",{ref:function(t){return e.canvas=t},className:"ScratchCard__Canvas",style:{position:"absolute",top:0,zIndex:1},width:this.props.width,height:this.props.height,onMouseDown:this.handleMouseDown,onTouchStart:this.handleMouseDown,onMouseMove:this.handleMouseMove,onTouchMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onTouchEnd:this.handleMouseUp}),n().createElement("div",{className:"ScratchCard__Result",style:i},this.props.children))}}],i&&s(o.prototype,i),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,i}(o.Component);module.exports=e})();